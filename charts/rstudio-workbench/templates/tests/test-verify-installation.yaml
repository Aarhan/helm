apiVersion: v1
kind: Pod
metadata:
  name: {{ include "rstudio-workbench.fullname" . }}-test
  annotations:
   "helm.sh/hook": test
spec:
  {{- if .Values.rbac.create }}
  serviceAccountName: {{ include "rstudio-workbench.fullname" . }}
  {{- end }}
  {{- if and (not .Values.rbac.create) (.Values.serviceAccountName) }}
  serviceAccountName: {{ .Values.serviceAccountName }}
  {{- end }}
  shareProcessNamespace: {{ .Values.shareProcessNamespace }}
  restartPolicy: Never
  {{- $overrideDict := . | deepCopy }}
  {{- $_ := set $overrideDict.Values "enableDiagnostics" true }}
  {{- $_ := set $overrideDict.Values "userCreate" true }}
  {{- $disabledObject := dict "enabled" false }}
  {{- $readinessProbe := dict "readinessProbe" $disabledObject }}
  {{- $livenessProbe := dict "livenessProbe" $disabledObject }}
  {{- $startupProbe := dict "startupProbe" $disabledObject }}
  {{- $prometheusExporter := dict "prometheusExporter" $disabledObject }}
  {{- $overrideValues := mergeOverwrite $overrideDict.Values $prometheusExporter $startupProbe $livenessProbe $readinessProbe }}
  {{- $_ := set $overrideDict "Values" $overrideValues }}
{{ include "rstudio-workbench.containers" $overrideDict | indent 2 }}
